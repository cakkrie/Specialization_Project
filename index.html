<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>About</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="style.css">
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- jsPlumb Toolkit CSS -->
  <script src="node_modules/@jsplumbtoolkit/browser-ui/js/jsplumbtoolkit.browser-ui.umd.js"></script>
  <link rel="stylesheet" href="node_modules/@jsplumbtoolkit/browser-ui/css/jsplumbtoolkit.css">
 </head>
<body>
  <header>
    <div class="left"><a href="index.html">FishOn</a></div>
    <div class="center">
      <a href="about.html">About</a>
      <a href="research.html">Research</a>
    </div>
  </header>

  <main>
    <section class="landing-page">
      <div class="landing-page-title">
        <div class="main-title">
          <div class="title-line">YOUR</div>
          <div class="title-line">FISHING GUIDE</div>
          <div class="title-line">INTELLIGENCE</div>
        </div>
        <div class="subtitle">Blend emotional support, real data, <br>
          and a gamified journey on every trip.</div>
      </div>
      <div class="cta">
        <a href="#landing-context" class="title-cta">
          <span class="cta-icon" aria-hidden="true">↳</span>
          <span class="cta-text">SEE WHAT WE DO</span>
        </a>
      </div>
    </section>

    <section class="landing-context" id="landing-context">
      <div class="landing-context-pin">
        <img src="Photo/journey-map/fish-background.jpg" alt="Fishing background" class="about-bg">
          <div class="overlay header-2xl" id="market-intro">
            The global fishing market continues to expand steadily, driven by rising seafood demand, growing recreational participation, and advances in aquaculture.
          </div>

        <div class="overlay header-2xl" id="mid-note" aria-hidden="true">
            In the recreation fishing, more and more yonger anglers are entering the market due to the change of lifestyle. 
        </div>

        <div class="overlay trend-row" id="trend-row" aria-hidden="true">
          <div class="overlay trend-card" id="young-trend" aria-hidden="true">
            <div class="trend-card-content">
              <div class="trend-category">User Trait1</div>
              <h3>Lack of experience</h3>
              <p>The growing participation among Gen Z usually don't have much experience and need help from friends to guide them on fishing.</p>
            </div>
          </div>
          <div class="overlay trend-card" id="rely-tech" aria-hidden="true">
            <div class="trend-card-content">
              <div class="trend-category">User Trait2</div>
              <h3>Rely on technology</h3>
              <p>Mobile apps, sonar, and AI-driven insights increasingly guide spot selection and tactics.</p>
            </div>
          </div>
          <div class="overlay trend-card" id="limited-time" aria-hidden="true">
            <div class="trend-card-content">
              <div class="trend-category">User Trait3</div>
              <h3>Limited time on fishing</h3>
              <p>Busy schedules push for efficient, outcome-oriented trips and bite-time optimization.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="hmw-section">
      <div class="hmw-bubbles-container">
        <div class="hmw-tags-prefix">Turn fishing actions into a personalized journey</div>
      </div>
      <div class="hmw-container">
        <div class="header-xl">How might we design a tool</div>
        <div class="header-3xl">for younger anglers <br>In the digitalized era?</div>
      </div>
      <div class="cta hmw-cta">
        <a href="ontology.html" class="title-cta" aria-label="Explore Ontology">
          <span class="cta-icon" aria-hidden="true">↳</span>
          <span class="cta-text">EXPLORE IMMERSIVELY
          </span>
        </a>
      </div>
    </section>

    <section class="map-community-section">
      <div class="map-community-content">
        <div class="header-3xl">Map of Community</div>
        <div class="map-community-cards">
          <div class="map-community-card">
              <div class="caption-base">(01)</div>
              <div class="body-sm">Shang Yu</div>
            <div class="map-community-card-content">
              <p>As China's leading fishing technology brand, Shangyu is dedicated to delivering localized tech solutions for the recreational fishing community, catering to anglers of all skill levels. By integrating AI technology with educational and interactive features, the platform creates an easy-to-use and engaging fishing experience, becoming a knowledgeable companion for every fishing trip.</p>
            </div>
              <div class="labels"><span class="label">Software</span></div>
          </div>
          <div class="map-community-card">
              <div class="caption-base">(02)</div>
              <div class="body-sm">LakeMonster</div>
            <div class="map-community-card-content">
              <p>An app that analyzes data points — including satellite imagery, weather patterns, water depth data, and historical fishing records to generate fish activity forecasts, hotspot maps, and water clarity maps.</p>
            </div>
              <div class="labels"><span class="label">Software</span></div>
          </div>
          <div class="map-community-card">
              <div class="caption-base">(03)</div>
              <div class="body-sm">Fishbuddy</div>
            <div class="map-community-card-content">
              <p>Smart decisions: uses 10+ weather factors (temp, pressure, humidity) to flag prime times, recommend bait, and navigate nearby spots. Social: in-app forum to share catches and techniques.</p>
            </div>
              <div class="labels"><span class="label">Software</span></div>
          </div>
          <div class="map-community-card">
              <div class="caption-base">(04)</div>
              <div class="body-sm">Sea.ai</div>
            <div class="map-community-card-content">
              <p>Smart camera: combines optical and infrared sensors, utilizes AI and ML algorithms to detect objects on the water surface.</p>
            </div>
              <div class="labels"><span class="label">Hardware</span></div>
          </div>
          <div class="map-community-card">
              <div class="caption-base">(05)</div>
              <div class="body-sm">Chasing F1 Pro</div>
            <div class="map-community-card-content">
              <p>Remote/autonomous lateral movement, station-hold, multi-spot waypoints. Depth &amp; temperature sensors; Wi‑Fi streams live video + depth/temp to the app. Bait-boat mount with one-tap in-app bait release.</p>
            </div>
              <div class="labels"><span class="label">Hardware</span></div>
          </div>
        </div>
        <div class="map-community-list">
          <div class="map-community-list-left">
            <div class="map-community-list-headline"><span class="headline-gray">Current solutions </span><span class="headline-white">overload anglers with information</span><span class="headline-gray"> and are </span><span class="headline-white">expensive for entry</span></div>
          </div>
          <div class="map-community-list-right">
            <div class="map-community-list-item">
              <div class="map-community-list-item-title">Software</div>
              <div class="map-community-list-item-content">
                <p>There are many software tools for fishing, such as Fishbuddy, LakeMonster, and Sea.ai. They are all good tools for fishing, but most of them are not very user-friendly for younger anglers as they display too much professional fishing knowledge.</p>
                <p>Younger anglers usually don't have much experience and need help from friends to interpret the knowledge or guide them in the fishing process.</p>
              </div>
            </div>
            <div class="map-community-list-item">
              <div class="map-community-list-item-title">Hardware</div>
              <div class="map-community-list-item-content">
                <p>The current hardware tools for fishing are expensive since they are not widely used in recreational fishing. Young anglers who haven't had much experience may not want to invest in expensive hardware tools.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

    </section>


    <section class="user-journey-section" style="background: #fff;">
      <div class="user-journey-pin">
        <div class="header-4xl primary">Literature Review</div>
        <div class="user-journey-cards">
          <div class="user-journey-card card-1" id="literature-1">
            <div class="user-journey-card-illustration">
              <img src="Photo/literature-review/Literature_1.png" alt="Literature 1" class="journey-illustration" data-modal-src="Photo/literature-review/Literature_1_Expand.png">
            </div>
            <div class="literature-card-icon">
              <i class="fas fa-plus"></i>
            </div>
          </div>
          <div class="user-journey-card card-2" id="literature-2">
            <div class="user-journey-card-illustration">
              <img src="Photo/literature-review/Literature_2.png" alt="Literature 2" class="journey-illustration" data-modal-src="Photo/literature-review/Literature_2_Expand.png">
            </div>
            <div class="literature-card-icon">
              <i class="fas fa-plus"></i>
            </div>
          </div>
          <div class="user-journey-card card-3" id="literature-3">
            <div class="user-journey-card-illustration">
              <img src="Photo/literature-review/Literature_3.png" alt="Literature 3" class="journey-illustration" data-modal-src="Photo/literature-review/Literature_3_Expand.png">
            </div>
            <div class="literature-card-icon">
              <i class="fas fa-plus"></i>
            </div>
          </div>
        </div>
      </div>
    </section>


    <section class="barrier-of-entry-section">
      <div class="barrier-of-entry-content">
        <!-- Barrier of Entry content will go here -->
        <div class="header-4xl primary">Barrier of Entry</div>
        <div class="body-sm" style="text-align: center;">in terms of technology and as a designer</div>
      </div>
      
      <div class="barrier-cards-container" id="barrierCards">
        <!-- Designer barriers (black indicator) -->
        <div class="barrier-card designer-barrier">
          <div class="barrier-card-upper">
            <div class="barrier-card-category">Designer</div>
            <h3 class="barrier-card-title">Complex Multi-Layer Information Architecture</h3>
          </div>
          <div class="barrier-card-lower">
            <div class="barrier-card-pattern"></div>
          </div>
        </div>

        <div class="barrier-card designer-barrier">
          <div class="barrier-card-upper">
            <div class="barrier-card-category">Designer</div>
            <h3 class="barrier-card-title">Gamification System Design</h3>
          </div>
          <div class="barrier-card-lower">
            <div class="barrier-card-pattern"></div>
          </div>
        </div>
        <div class="barrier-card designer-barrier">
          <div class="barrier-card-upper">
            <div class="barrier-card-category">Designer</div>
            <h3 class="barrier-card-title">Emotion-Addressing UX & Tone Design</h3>
          </div>
          <div class="barrier-card-lower">
            <div class="barrier-card-pattern"></div>
          </div>
        </div>
        
        <!-- Technology barriers (gray indicator) -->
        <div class="barrier-card technology-barrier">
          <div class="barrier-card-upper">
            <div class="barrier-card-category">Technology</div>
            <h3 class="barrier-card-title">Multi-Source Fishing Data Complexity</h3>
          </div>
          <div class="barrier-card-lower">
            <div class="barrier-card-pattern"></div>
          </div>
        </div>
        <div class="barrier-card technology-barrier">
          <div class="barrier-card-upper">
            <div class="barrier-card-category">Technology</div>
            <h3 class="barrier-card-title">Emotional Modeling Complexity</h3>
          </div>
          <div class="barrier-card-lower">
            <div class="barrier-card-pattern"></div>
          </div>
        </div>
        <div class="barrier-card technology-barrier">
          <div class="barrier-card-upper">
            <div class="barrier-card-category">Technology</div>
            <h3 class="barrier-card-title">Trust & Behavior Barriers Among Anglers</h3>
          </div>
          <div class="barrier-card-lower">
            <div class="barrier-card-pattern"></div>
          </div>
        </div>
        <div class="barrier-card technology-barrier">
          <div class="barrier-card-upper">
            <div class="barrier-card-category">Technology</div>
            <h3 class="barrier-card-title">Sparse / Imprecise Location Data</h3>
          </div>
          <div class="barrier-card-lower">
            <div class="barrier-card-pattern"></div>
          </div>
        </div>
        <div class="barrier-card technology-barrier">
          <div class="barrier-card-upper">
            <div class="barrier-card-category">Technology</div>
            <h3 class="barrier-card-title">Gamification × Real Data Synchronization</h3>
          </div>
          <div class="barrier-card-lower">
            <div class="barrier-card-pattern"></div>
          </div>
        </div>
      </div>
    </section>

    
    <br>
    <br>
    <br>
    <br>    <div class="header-4xl primary">How it works</div>
    <div class="body-sm" style="text-align: center;">An uml diagram of the specilized fishing map</div>
  

    <section class="uml-section">
      <div class="uml-diagram-container" id="uml-diagram">
        <!-- UML cards will be dynamically generated from JSON data -->
      </div>
    </section>

    <section class="technology-ecosystem-section" id="technologyEcosystem">
      <div class="technology-ecosystem-pin">
        <div class="tech-eco-title">Technology Ecosystem</div>
        <div class="tech-eco-img-container">
          <img src="Photo/technology-ecosystem/Technology-ecosystem1.png" alt="Technology Ecosystem 1" class="tech-eco-img tech-eco-img-1">
          <img src="Photo/technology-ecosystem/Technology-ecosystem2.png" alt="Technology Ecosystem 2" class="tech-eco-img tech-eco-img-2">
          <img src="Photo/technology-ecosystem/Technology-ecosystem3.png" alt="Technology Ecosystem 3" class="tech-eco-img tech-eco-img-3">
        </div>
      </div>
    </section>

    <section class="user-journey-section">
      <div class="user-journey-pin">
        <div class="header-4xl primary">User Journey</div>
        <div class="user-journey-preview" id="journeyPreview">
          <div class="journey-preview-item">
            <div class="journey-preview-circle">1</div>
            <div class="journey-preview-label">constructing a <br>customer journey</div>
          </div>
          <div class="journey-preview-item">
            <div class="journey-preview-circle">2</div>
            <div class="journey-preview-label">unexpected<br>pivot</div>
          </div>
          <div class="journey-preview-item">
            <div class="journey-preview-circle">3</div>
            <div class="journey-preview-label">unintended<br>accident</div>
          </div>
        </div>
        <div class="user-journey-cards">
          <div class="user-journey-card card-1" id="journey-card-1">
            <div class="user-journey-card-content-section">
              <div class="user-journey-card-header">
                <h3 class="user-journey-card-title">Constructing a<br>customer journey</h3>
              </div>
              <div class="user-journey-card-number">01.</div>
              <div class="user-journey-card-description">
                The complete path users take when interacting with our map to understand their needs, motivations, and pain points.
              </div>
            </div>
            <div class="user-journey-card-illustration">
              <img src="Photo/journey-map/Constructing-a-customer-journey.png" alt="Constructing a customer journey" class="journey-illustration" data-modal-src="Photo/journey-map/detail-map-1.png">
            </div>
          </div>
          <div class="user-journey-card card-2" id="journey-card-2">
            <div class="user-journey-card-content-section">
              <div class="user-journey-card-header">
                <h3 class="user-journey-card-title">Unexpected<br>Pivot</h3>
              </div>
              <div class="user-journey-card-number">02.</div>
              <div class="user-journey-card-description">
                An unplanned change in direction caused by external factors during the user journey.
              </div>
            </div>
            <div class="user-journey-card-illustration">
              <img src="Photo/journey-map/Unexpected-pivot.png" alt="Unexpected pivot" class="journey-illustration" data-modal-src="Photo/journey-map/detail-map-2.png">
            </div>
          </div>
          <div class="user-journey-card card-3" id="journey-card-3">
            <div class="user-journey-card-content-section">
              <div class="user-journey-card-header">
                <h3 class="user-journey-card-title">Unintended<br>Accident</h3>
              </div>
              <div class="user-journey-card-number">03.</div>
              <div class="user-journey-card-description">
                An unexpected user behavior or outcome that reveals hidden issues or opportunities in the design.
              </div>
            </div>
            <div class="user-journey-card-illustration">
              <img src="Photo/journey-map/Unintended-accident.png" alt="Unintended accident" class="journey-illustration" data-modal-src="Photo/journey-map/detail-map-3.png">
            </div>
          </div>
        </div>
        <div class="user-journey-footer-text">
          Visualizing a user journey map helps teams clearly understand users' experiences, identify pain points, and uncover opportunities for improvement across the entire journey.
        </div>
      </div>
    </section>

    <!-- Fullscreen Image Modal -->
    <div class="image-modal" id="imageModal">
      <button class="image-modal-close" id="closeModal" aria-label="Close modal">×</button>
      <img class="image-modal-content" id="modalImage" src="" alt="">
    </div>


      <!-- Earth Visualization Section -->
    <div class="earth-section">
      <div class="earth-section-pin">
        <div class="earth-content">
          <div class="earth-info" id="earth-info">
            <div class="info-item active" data-layer="bottom">
              <div class="header-md font-weight-semibold">Input</div>
              <div class="body-sm">
              <ul>
                  <li>What time period I want to fish</li>
                  <li>Acceptable distance range</li>
                  <li>Type of fishing</li>
                </ul>
              </div>
              <br><br>
              <div class="header-md font-weight-semibold">Output</div>
              <div class="body-sm">
                <ul>
                  <li>GPS API</li>
                  <li>Weather API</li>
                  <li>Ideal time suggestions</li>
                  <li>Overall recommendation score</li>
              </ul>
              </div>
            </div>
            <div class="info-item" data-layer="top">
              <div class="header-md font-weight-semibold">Input</div>
              <div class="body-sm">
               <ul>
                <li>video of current surrounding</li>
                <li>GPS</li>
              </ul>
              </div>
              <br><br>
              <div class="header-md font-weight-semibold">Processing</div>
              <div class="body-sm">
               <ul>
                <li>Feature Extraction</li>
                <li>3D Environment Reconstruction</li>
              </ul>
              </div>
              <br><br>
              <div class="header-md font-weight-semibold">Output</div>
              <div class="body-sm">
               <ul>
                <li>Shade Analysis</li>
                <li>Fish Cluster Prediction</li>
                <li>Spot Recommendation & Change Forecasting</li>

              </ul>
              </div>

            </div>

          </div>
        </div>

        <div class="earth-container">
          <div class="earth-layers">
            <canvas id="layer-bottom" class="earth-layer" data-layer="bottom" width="520" height="520"></canvas>
            <canvas id="layer-middle" class="earth-layer" data-layer="middle" width="520" height="520"></canvas>
            <canvas id="layer-top" class="earth-layer" data-layer="top" width="520" height="520"></canvas>
          </div>
        </div>
        <div class="earth-titles">
          <div class="earth-title-text active" data-layer="bottom">
            <span>2D Map</span>
            <span class="title-body">A data-driven map that visualizes real fishing spots, weather, and location information for quick decision-making</span>
          </div>
          <div class="earth-title-text" data-layer="top">
            <span>4D XR Map</span>
            <span class="title-body">An extended-reality environment that anchors fish and environment in real-world space, merging physical and virtual fishing experiences.</span>
          </div>
        </div>
      </div>
    </div>

       <!-- Parallax Section -->
    <div class="parallax-container" id="parallax-container">
      <div class="parallax-wrapper">
        <img src="Photo/bottom_layer.png" alt="Bottom Layer Parallax" class="parallax-image" id="parallax-image">
            
        <div class="screen-container">
          <img src="Photo/buttom2_screen.png" alt="Screen 2" class="phone-screen screen-2">
          <img src="Photo/buttom3_screen.png" alt="Screen 3" class="phone-screen screen-3">
        </div>
            
        </div> 
      </div>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
    </div>


    <section class="user-journey-section">
      <div class="header-4xl primary">User Journey</div>
      <p>Letting users to "see" the dynamic fish habitats and real-time encouragement from an AI multidimensional agent, creating an immersive yet emotionally supportive fishing journey</p>

    </section>


    <section class="responsive-cards-section">
      <div class="header-4xl primary">Radical Prototype</div>
      <p>Letting users to "see" the dynamic fish habitats and real-time encouragement from an AI multidimensional agent, creating an immersive yet emotionally supportive fishing journey</p>
      <div class="responsive-cards-grid">
        <div class="responsive-card">
          <div class="header-xl">Fishing Tech</div>
          <div class="responsive-card-description">div class="responsive-card-description">Envisions a future where fishing blends data, emotion, and nature to explore new nature–AI relationships.</div>
          </div>
          <div class="responsive-card">
            <div class="header-xl">Provocative</div>
            <div class="responsive-card-description">Balance tech's focus on efficiency and experience with emphasizing mindfulness, emotion, and play.</div>
          </div>
          <div class="responsive-card">
            <div class="header-xl">Narrative-driven</div>
            <div class="responsive-card-description">BBuilds a story between user, environment and community through every fishing journey.</div>
          </div>
          <div class="responsive-card">
            <div class="header-xl">Experience over functional</div>
            <div class="responsive-card-description">BFocuses on illustrating ideas of journey while blending technical completion.</div>
          </div>
          <div class="responsive-card">
            <div class="header-xl">Speculative</div>
            <div class="responsive-card-description">BConnects speculative storytelling with design research to reflect on the fishing community.</div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <script>
    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      initEarthInteraction();
      initStickyEffect();
      initAboutLanding2Scroll();
      initUserJourneyScroll();
      initLiteratureReviewScroll();
      initImageModal();
      initBarrierCircles();
      initTechnologyEcosystemScroll();
    });
    

    // User Journey scroll animations - similar to landing-context
    function initUserJourneyScroll() {
      const preview = document.getElementById('journeyPreview');
      if (!preview) return;
      
      // Find the section that contains the journeyPreview element
      const section = preview.closest('.user-journey-section');
      const card1 = document.getElementById('journey-card-1');
      const card2 = document.getElementById('journey-card-2');
      const card3 = document.getElementById('journey-card-3');
      
      if (!section || !card1 || !card2 || !card3) return;

      const SCROLL_LENGTH = 2000; // total pinned scroll distance in px

      // Ensure section height supports sticky duration
      section.style.minHeight = `calc(100vh + ${SCROLL_LENGTH}px)`;

      function render() {
        const start = section.offsetTop;
        const y = window.scrollY;
        const delta = Math.min(Math.max(y - start, 0), SCROLL_LENGTH);

        // Reset all
        card1.classList.remove('visible');
        card2.classList.remove('visible');
        card3.classList.remove('visible');

        // Show cards gradually based on scroll progress
        if (delta < 600) {
          // First 600px: show title and preview circles, no cards
          preview.classList.remove('hidden');
        } else if (delta < 1200) {
          // 600-1200px: hide preview, show first card
          preview.classList.add('hidden');
          card1.classList.add('visible');
        } else if (delta < 1800) {
          // 1200-1800px: show first and second card
          preview.classList.add('hidden');
          card1.classList.add('visible');
          card2.classList.add('visible');
        } else {
          // 1800px+: show all three cards
          preview.classList.add('hidden');
          card1.classList.add('visible');
          card2.classList.add('visible');
          card3.classList.add('visible');
        }
      }

      window.addEventListener('scroll', render, { passive: true });
      window.addEventListener('resize', render);
      render();
    }

    // Literature Review scroll animations - same as User Journey
    function initLiteratureReviewScroll() {
      const card1 = document.getElementById('literature-1');
      if (!card1) return;
      
      // Find the section that contains the literature review cards
      const section = card1.closest('.user-journey-section');
      const card2 = document.getElementById('literature-2');
      const card3 = document.getElementById('literature-3');
      
      if (!section || !card2 || !card3) return;

      // Find the title element
      const title = section.querySelector('.header-4xl.primary');

      const SCROLL_LENGTH = 2000; // total pinned scroll distance in px

      // Ensure section height supports sticky duration
      section.style.minHeight = `calc(100vh + ${SCROLL_LENGTH}px)`;

      function render() {
        const start = section.offsetTop;
        const y = window.scrollY;
        const delta = Math.min(Math.max(y - start, 0), SCROLL_LENGTH);

        // Reset all
        card1.classList.remove('visible');
        card2.classList.remove('visible');
        card3.classList.remove('visible');

        // Show cards gradually based on scroll progress
        if (delta < 600) {
          // First 600px: show title only, no cards
          if (title) title.style.opacity = '1';
          if (title) title.style.visibility = 'visible';
        } else if (delta < 1200) {
          // 600-1200px: hide title, show first card
          if (title) title.style.opacity = '0';
          if (title) title.style.visibility = 'hidden';
          card1.classList.add('visible');
        } else if (delta < 1800) {
          // 1200-1800px: show first and second card
          if (title) title.style.opacity = '0';
          if (title) title.style.visibility = 'hidden';
          card1.classList.add('visible');
          card2.classList.add('visible');
        } else {
          // 1800px+: show all three cards
          if (title) title.style.opacity = '0';
          if (title) title.style.visibility = 'hidden';
          card1.classList.add('visible');
          card2.classList.add('visible');
          card3.classList.add('visible');
        }
      }

      window.addEventListener('scroll', render, { passive: true });
      window.addEventListener('resize', render);
      render();
    }

    // Image Modal functionality
    function initImageModal() {
      const modal = document.getElementById('imageModal');
      const modalImage = document.getElementById('modalImage');
      const closeBtn = document.getElementById('closeModal');
      const cards = document.querySelectorAll('.user-journey-card');

      if (!modal || !modalImage || !closeBtn) return;

      // Add click event to each card
      cards.forEach(card => {
        card.addEventListener('click', function() {
          const img = this.querySelector('.journey-illustration');
          if (img) {
            // Use data-modal-src if available, otherwise use the image src
            const modalSrc = img.getAttribute('data-modal-src') || img.src;
            modalImage.src = modalSrc;
            modalImage.alt = img.alt || 'Fullscreen image';
            modal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
          }
        });
      });

      // Close modal when clicking close button
      closeBtn.addEventListener('click', function() {
        modal.classList.remove('active');
        document.body.style.overflow = ''; // Restore scrolling
      });

      // Close modal when clicking outside the image
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          modal.classList.remove('active');
          document.body.style.overflow = ''; // Restore scrolling
        }
      });

      // Close modal with ESC key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
          modal.classList.remove('active');
          document.body.style.overflow = ''; // Restore scrolling
        }
      });
    }

    // Barrier of Entry cards initialization (no positioning needed - using CSS grid)
    function initBarrierCircles() {
      // Cards are now displayed in a grid layout via CSS, no JavaScript positioning needed
      // This function is kept for compatibility but does nothing
      const container = document.getElementById('barrierCards');
      if (!container) return;
      // Grid layout handles positioning automatically
    }

    // Technology Ecosystem scroll animation
    function initTechnologyEcosystemScroll() {
      const section = document.getElementById('technologyEcosystem');
      if (!section) return;

      const img1 = section.querySelector('.tech-eco-img-1');
      const img2 = section.querySelector('.tech-eco-img-2');
      const img3 = section.querySelector('.tech-eco-img-3');

      if (!img1 || !img2 || !img3) return;

      // Initialize: show first image
      img1.classList.add('active');

      const SCROLL_LENGTH = 2000; // total scroll distance for the section
      section.style.minHeight = `calc(100vh + ${SCROLL_LENGTH}px)`;

      function render() {
        const start = section.offsetTop;
        const y = window.scrollY;
        const delta = Math.min(Math.max(y - start, 0), SCROLL_LENGTH);
        const progress = delta / SCROLL_LENGTH;

        // Reset all images
        img1.classList.remove('active');
        img2.classList.remove('active');
        img3.classList.remove('active');

        // Show images based on scroll progress
        if (progress < 0.33) {
          // First third: show image 1
          img1.classList.add('active');
        } else if (progress < 0.66) {
          // Second third: show image 2
          img2.classList.add('active');
        } else {
          // Last third: show image 3
          img3.classList.add('active');
        }
      }

      window.addEventListener('scroll', render, { passive: true });
      window.addEventListener('resize', render);
      render();
    }


    // Initialize file tags for HMW section
    function initHMWBubbles() {
      const bubbleContainer = document.querySelector('.hmw-bubbles-container');
      if (!bubbleContainer) return;

      // Create grid container for all tags (check weather first, then others)
      const tagsGrid = document.createElement('div');
      tagsGrid.className = 'hmw-tags-grid';

      // All tags - check weather first, then others
      const fileTags = [
        { icon: 'cloud', text: 'Check weather & forecast' },
        { icon: 'fish', text: 'Target species' },
        { icon: 'map-pin', text: 'Target location' },
        { icon: 'file-check', text: 'Verify local regulations' },
        { icon: 'calendar', text: 'Check calendar' },
        { icon: 'fish', text: 'Prepare bait' },
        { icon: 'navigation', text: 'Navigate to destination' },
        { icon: 'users', text: 'Plan trip with friends' },
        { icon: 'book-open', text: 'Learn tutorials' },
        { icon: 'user-check', text: 'Schedule local guide' }
      ];

      // Create all file tags in grid layout
      fileTags.forEach((item, index) => {
        const tag = document.createElement('div');
        tag.className = 'hmw-file-tag';
        tag.innerHTML = `<i data-lucide="${item.icon}"></i><span>${item.text}</span>`;
        tagsGrid.appendChild(tag);
      });

      // Insert grid after prefix and before suffix
      const prefix = bubbleContainer.querySelector('.hmw-tags-prefix');
      const suffix = bubbleContainer.querySelector('.hmw-tags-suffix');
      if (prefix && suffix) {
        prefix.insertAdjacentElement('afterend', tagsGrid);
      } else {
        bubbleContainer.appendChild(tagsGrid);
      }

      // Initialize Lucide icons for the tags
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    }

    // Initialize animations and load header when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Lucide icons
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
      
      initHMWBubbles();
    });

    // Sticky scroll control for landing-context (2500px total pin, 5 stages)
    function initAboutLanding2Scroll() {
      const section = document.querySelector('.landing-context');
      const pin = document.querySelector('.landing-context-pin');
      const intro = document.getElementById('market-intro');
      const midNote = document.getElementById('mid-note');
      const trendRow = document.getElementById('trend-row');
      const card1 = document.getElementById('young-trend');
      const card2 = document.getElementById('rely-tech');
      const card3 = document.getElementById('limited-time');
      if (!section || !pin || !intro || !midNote || !trendRow || !card1 || !card2 || !card3) return;

      const SCROLL_LENGTH = 2500; // total pinned scroll distance in px

      // Ensure section height supports sticky duration
      section.style.minHeight = `calc(100vh + ${SCROLL_LENGTH}px)`;

      function render() {
        const start = section.offsetTop;
        const y = window.scrollY;
        const delta = Math.min(Math.max(y - start, 0), SCROLL_LENGTH);

        // Reset all
        intro.classList.remove('visible');
        midNote.classList.remove('visible');
        trendRow.classList.remove('visible');
        card1.classList.remove('visible');
        card2.classList.remove('visible');
        card3.classList.remove('visible');
        midNote.setAttribute('aria-hidden', 'true');
        trendRow.setAttribute('aria-hidden', 'true');
        card1.setAttribute('aria-hidden', 'true');
        card2.setAttribute('aria-hidden', 'true');
        card3.setAttribute('aria-hidden', 'true');

        if (delta < 500) {
          intro.classList.add('visible');
        } else if (delta < 1000) {
          midNote.classList.add('visible');
          midNote.setAttribute('aria-hidden', 'false');
        } else {
          trendRow.classList.add('visible');
          trendRow.setAttribute('aria-hidden', 'false');
          // show all three together
          card1.classList.add('visible');
          card2.classList.add('visible');
          card3.classList.add('visible');
          card1.setAttribute('aria-hidden', 'false');
          card2.setAttribute('aria-hidden', 'false');
          card3.setAttribute('aria-hidden', 'false');
        }
      }

      window.addEventListener('scroll', render, { passive: true });
      window.addEventListener('resize', render);
      render();
    }

    // 实现滚动时的视差效果
    function initStickyEffect() {
       const parallaxWrapper = document.querySelector('.parallax-wrapper');
       const parallaxContainer = document.getElementById('parallax-container');
      const earthSection = document.querySelector('.earth-section');
      const earthLayers = document.querySelector('.earth-layers');
       const landingContextSection = document.querySelector('.landing-context');
       // const progressRing = document.querySelector('.progress-ring'); // 已隐藏
       // const progressSections = document.querySelectorAll('.progress-circle'); // 已隐藏
       const titleTexts = document.querySelectorAll('.title-text');
       const phoneScreens = document.querySelectorAll('.phone-screen');
       
       if (!parallaxWrapper || !parallaxContainer || !earthSection || !earthLayers) return;
       
      const viewportHeight = window.innerHeight;
      parallaxContainer.style.height = `${viewportHeight * 2}px`;
       let hasStartedParallax = false;
       let parallaxStartY = 0; // 在外部作用域定义，供 changeImageWithTransition 使用
      
      // 计算各区域位置的辅助函数
      function getSectionPositions() {
        const earthSectionTop = earthSection.offsetTop;
        const earthSectionBottom = earthSectionTop + earthSection.offsetHeight;
        const parallaxEarlyOffset = viewportHeight * 0.8;
        parallaxStartY = Math.max(earthSectionTop, earthSectionBottom - parallaxEarlyOffset); // 更新外部变量
        const parallaxEndY = parallaxStartY + (viewportHeight * 2);
        
        let landingContextTop = Infinity;
        let landingContextBottom = Infinity;
        if (landingContextSection) {
          landingContextTop = landingContextSection.offsetTop;
          landingContextBottom = landingContextTop + landingContextSection.offsetHeight;
        }
        
        return {
          landingContextTop,
          landingContextBottom,
          earthSectionTop,
          earthSectionBottom,
          parallaxStartY,
          parallaxEndY
        };
      }
      
      // 隐藏 parallax 的辅助函数
      function hideParallax() {
        parallaxWrapper.className = 'parallax-wrapper';
        parallaxWrapper.style.opacity = '0';
        parallaxWrapper.style.visibility = 'hidden';
        titleTexts.forEach(title => title.classList.remove('visible'));
        phoneScreens.forEach(screen => screen.classList.remove('active'));
      }
      
      // 显示 parallax 的辅助函数
      function showParallax() {
        parallaxWrapper.className = 'parallax-wrapper center';
        parallaxWrapper.style.opacity = '';
        parallaxWrapper.style.visibility = '';
        if (!hasStartedParallax) {
          earthLayers.classList.add('hidden');
          hasStartedParallax = true;
        }
      }
      
      function handleScroll() {
        const scrollY = window.scrollY;
        const positions = getSectionPositions();
        
        // 1. 在 landing-context 区域：完全隐藏 parallax
        if (scrollY >= positions.landingContextTop && scrollY < positions.landingContextBottom) {
          hideParallax();
          earthLayers.classList.remove('hidden');
          hasStartedParallax = false;
          return;
        }
        
        // 2. 在 earth-section 区域：显示 earth layers，隐藏 parallax
        if (scrollY >= positions.earthSectionTop && scrollY < positions.parallaxStartY) {
          hideParallax();
          earthLayers.classList.remove('hidden');
          hasStartedParallax = false;
          return;
        }
        
        // 3. 在 parallax 区域：显示 parallax，隐藏 earth layers
        if (scrollY >= positions.parallaxStartY && scrollY <= positions.parallaxEndY) {
          showParallax();
          
          // 根据滚动进度显示不同的标题
          const progress = (scrollY - positions.parallaxStartY) / (viewportHeight * 2);
          const scale = 1 + (progress * 0.1); // 从1.0轻微缩放到1.1
          
          // 只对 parallax-image 应用缩放，不影响 phone-screen
          const parallaxImage = document.querySelector('.parallax-image');
          if (parallaxImage) {
            parallaxImage.style.transform = `scale(${scale})`;
            // 确保 buttom2、buttom3.png 的透明度保持为 50%
            const currentSrc = parallaxImage.src;
            if (currentSrc.includes('buttom2.png') || currentSrc.includes('buttom3.png')) {
              parallaxImage.style.opacity = '0.5';
            }
          }
          
          // 控制标题显示
          updateTitles(progress);
          return;
        }
        
        // 4. 超过 parallax 区域：保持最后状态，恢复 earth layers
        if (scrollY > positions.parallaxEndY) {
          showParallax();
          const parallaxImage = document.querySelector('.parallax-image');
          if (parallaxImage) {
            parallaxImage.style.transform = 'scale(1.1)';
          }
          updateTitles(1);
          earthLayers.classList.remove('hidden');
          hasStartedParallax = false;
          return;
        }
        
        // 5. 在 earth-section 之前：完全隐藏 parallax
        hideParallax();
        const parallaxImage = document.querySelector('.parallax-image');
        if (parallaxImage) {
          parallaxImage.style.transform = '';
        }
        earthLayers.classList.remove('hidden');
        hasStartedParallax = false;
      }
      
       // 更新标题显示函数
       function updateTitles(progress) {
         const parallaxImage = document.querySelector('.parallax-image');
         const phoneScreens = document.querySelectorAll('.phone-screen');
         
         // 隐藏所有标题
         titleTexts.forEach(title => {
           title.classList.remove('visible');
         });
         
         // 隐藏所有屏幕
         phoneScreens.forEach(screen => {
           screen.classList.remove('active');
         });
         
         // 移除所有颜色类
         parallaxImage.classList.remove('color-bottom', 'color-middle', 'color-top');
         
        // 根据滚动进度显示对应的标题和屏幕
        // 调整进度分配：screen-2 显示前 2/3，screen-3 显示后 1/3
        if (progress >= 0 && progress < 0.66) {
          if (titleTexts[0]) titleTexts[0].classList.add('visible');
          if (phoneScreens[0]) phoneScreens[0].classList.add('active');
          changeImageWithTransition('Photo/buttom2.png', 1.2);
        } else if (progress >= 0.66) {
          if (titleTexts[1]) titleTexts[1].classList.add('visible');
          if (phoneScreens[1]) phoneScreens[1].classList.add('active');
          changeImageWithTransition('Photo/buttom3.png', 1.2);
        }
       }
       
       // 带过渡效果的图片切换函数
       function changeImageWithTransition(newSrc, scaleSize = 1) {
         const parallaxImage = document.querySelector('.parallax-image');
         if (parallaxImage.src.includes(newSrc)) return; // 如果已经是目标图片，不重复切换
         
         // 获取当前滚动进度，保持缩放一致性
        const currentProgress = (window.scrollY - parallaxStartY) / (viewportHeight * 2);
         const currentScale = 1 + (currentProgress * 0.1);
         
        // 检查是否是 buttom2 或 buttom3.png，设置透明度为 50%
        const isButtomImage = newSrc.includes('buttom2.png') || newSrc.includes('buttom3.png');
         const targetOpacity = isButtomImage ? '0.5' : '1';
         
         // 淡出
         parallaxImage.style.opacity = '0.3';
         parallaxImage.style.transform = `scale(${currentScale * 0.95})`;
         
         setTimeout(() => {
           // 切换图片
           parallaxImage.src = newSrc;
           
           // 淡入并应用当前滚动对应的缩放和透明度
           parallaxImage.style.opacity = targetOpacity;
           parallaxImage.style.transform = `scale(${currentScale})`;
         }, 300); // 300ms后切换图片
       }
      

      // 初始化时确保图像处于隐藏状态
      parallaxWrapper.className = 'parallax-wrapper';
      
      // 监听滚动事件
      window.addEventListener('scroll', handleScroll);
      
      // 初始检查
      handleScroll();
    }

    // Data URI constants for the three layers
    const LAYER_DATA = {
      bottom: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQACAYAAAB/HSuDAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAE3NSURBVHgB7d3LdlzltS/w+a2yfAinsZWmx5bZJRnGSC/mCSI3LHucTswTYJ7A5gkwT4B5AswToHRyZNNAeQKcHmPgSwUrcTO1GwfYlmp9p5YsGd91q8u6/H5jbKpUqthhx4ia/2/O+aUAAGauf+Xh4ju/vrNYPd+JnX71mCP197+fy/z0eUr/kSIWn/+PPv/r5Je+fu4br3/9sFIMXv/yK68PfvstYxg5//fTN6ZhSuOvy3KYijTcfWn82Ct7wx82zrz21wYApisFAHAif7j8uF89VoX8fhG/W8D/Vrz3cx4/pr1C/qTFeXsMx/8/GT4XKgyehQhVgJDLQRUaCA4AYDIEAADwBlVhv1/U7xbwEf/1rKDfP3lXzM9a1U0w2O0uqAKDnP/xfFhwKk4NBAUA8HoCAAA6qSruR8VosSzj/G/FfVXo77beV/+3GDTZXlCQBjnyoOoqSJHvViHBzjs7dwfry8MAgI4RAADQStWM/cKThf5+gT/+F94fx//aWxwXg+fjacGvwOdu1UmQx4/j5/+ougiKU8Vg+/T2QEAAQBsJAABorP1FetsxWt0v8seP53dn7bXmczLVEsMqGNgdM6i6B6pw4Me/Lt0NAGgoAQAAtffSaf4fd1v1n57k9wNm74XOgSLlu8YKAGgCAQAAtaHQp+F2uwaqYCDl8m/VvoF7G2c3AwBqQgAAwFxUS/i2y+3zORX93db9iFWFPi11d3cZYS7/XhSx6aYCAOZFAADA1O0W+0/n9P+4t2l/NSzho9te6BawXwCAWRAAADBRLxb7u63850OxD4fxQiiwUCzc1SkAwCQJAAA4tmpm/9...',
      middle: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQACAYAAAB/HSuDAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUACAMZSURBVHgB7P3dsyXJcSeIuUeec++tr/4ApwBi2RSKWIga67EZ9hrN1kz7goJsSe6YyYzAkE3JTCYB86Y3YEd/QHXNHzAg/wGhYbsP0jQwjTGjCQtgbLrwIDM9DDXNh20bURRQGDTRBIpgd6M+7r3nZEbI3SMiT2RkRGaeW99V/uu+dfJkRkZERkac8J+7hweCQqFQKBSKx4Lvvv3BFf5stt1LiO4ly38WXuJzBlGugTEOAa5YcGDoq3P4EgKlc47T0FmgdPRpnSRHyoi+0i3uCvJ152JxfIBJ8S5cx+xaPL7pv8bL8vER3fIR1QmAKhou9+ko5U1rLUqdO/cTucXZj4zBj1r+slpJ2n/6pU/fBIVCoVAoFI8cCAqFQqFQKO4Lb7/945eO4OglaNsrhkg8WvOSa/AzRH9fIv4thB2weZFY+m8FQn0luT0S7hFBD59YSLsIrAwIBH9wPFV2JV0pr7xuS5E+w81eqeBzu0kXPwLrPkaHN50h5YEj5QEpDk7g5KMvfem3PgKFQqFQKBRnhioAFAqFQqGogC30bJ0nInpFSD2SVd2YzzCpZxLvyFqPhi3wPYTc5iQ6s8T36bJ75DixyAMMyXlJITDIM7HoL0JSz5ECIK2PeBX4L7V6lBQTLjREXtbeiO0neVi4iQ3+RDwQRGGAN9nboEN3k9OerNp3VVGgUCgUCkUZqgBQKBQKxXOJaLU33fY1b7GH36FJ8SWisle8Wz2QBb8n8+mtI+I+5WYPY9f6RVb27HyuQCjBFeoHSZmjeub5zigq9oFL8iqVP3kv1J8hbR9XyzvoHX6CBm+6tvvINOZduu0jdN...',
      top: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQACAYAAAB/HSuDAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUABqJtSURBVHgB7P1djxxXliWIni/78PBwkpFkSBRb6lSzs1nZjFu4aAg9BdSti+QA8zSoeYwE+u0+9UP/iYj4E/nQf2AAxWPdx7p3mEBPA4WGULioIdHFzuFVtrIoSkEqGPTwcPs658xe+xzz8AiSSkmZKSlTewWdZm5ubm5uEWZ29tprr62UQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgEAoFAIBAIBAKBQCAQCAQCgUAgEAgE3zK0EggEAoHgjxM6xjjOR03Ac0yUQCAQCAQCgeAVCAEgEAgEgu8dKJDn+1MO5lNgj1uWVpF+NP4b5/kN+H8t7Nd5cRwX0rq0bJ0wEKJAIBAIBALBDw5OCQQCgUDw/cAqg69zdI8Af/9gn8N7PD/YPzC8Iq+aSIKDgwOt9jGztqW9FPnjtf29vRVpgOd7+3sRn8DvzySCkAECgUAgEAh+CBAFgEAgEAi+U+SsvF7dkWJ6EtdS+jnS12pvP4IQuHv3rj5Uh2rn4U5aaU9dJAAID2idnd2HtD5e31vl/pkw4EV78Xz7WV3wipZAIBAIBAKB4E8HQgAIBAKB4DsDgn8KyA2C8QNF2Xm1t2IDOPNPgf3dw7v6IQXyDw4f6N3dXXV4SIH/9g7fvx4cPbgQrGP5K8t2M0mwRhDsE...'
    };

    // Earth layer interaction functionality
    function initEarthInteraction() {
      const canvases = document.querySelectorAll('.earth-layer');
      const infoItems = document.querySelectorAll('.info-item');
      const earthLayersContainer = document.querySelector('.earth-layers');
      
      // 初始化：显示bottom层内容
      showInfoForLayer('bottom');
      
      // 设置canvas
      setupCanvases();
      
      function setupCanvases() {
        const imageFiles = {
          'bottom': 'Photo/bottom.png',
          'middle': 'Photo/middle.png', 
          'top': 'Photo/top.png'
        };
        
        canvases.forEach(canvas => {
          const layerType = canvas.getAttribute('data-layer');
          const ctx = canvas.getContext('2d');
          
          // 设置canvas尺寸
          canvas.width = 520;
          canvas.height = 520;
          
          // 加载对应的PNG图片
          const img = new Image();
          img.onload = function() {
            // 清空canvas
            ctx.clearRect(0, 0, 520, 520);
            // 绘制图片
            ctx.drawImage(img, 0, 0, 520, 520);
          };
          img.src = imageFiles[layerType];
        });
      }
      
      // 使用mousemove事件来检测鼠标位置
      earthLayersContainer.addEventListener('mousemove', function(e) {
        const rect = this.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        
        // 检查是否在地球范围内
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        const distance = Math.sqrt(
          Math.pow(mouseX - centerX, 2) + Math.pow(mouseY - centerY, 2)
        );
        const radius = rect.width / 2;
        
        if (distance > radius) {
          return; // 鼠标在地球外
        }
        
        // 使用基于区域的检测
        const detectedLayer = detectLayerByRegion(mouseX, mouseY, rect);
        showInfoForLayer(detectedLayer);
      });
      
      function detectLayerByRegion(mouseX, mouseY, rect) {
        // 将鼠标位置转换为相对坐标 (0-1)
        const x = mouseX / rect.width;
        const y = mouseY / rect.height;
        
        // 计算距离中心的相对距离
        const centerX = 0.5;
        const centerY = 0.5;
        const distanceFromCenter = Math.sqrt(
          Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2)
        );
        
        // 边缘区域 (距离中心 > 40%) - 蓝色海洋
        if (distanceFromCenter > 0.4) {
          return 'bottom';
        }
        // 外围区域 (距离中心 25-40%) - 大陆边缘
        else if (distanceFromCenter > 0.25) {
          // 在特定角度范围内检测大陆
          const angle = Math.atan2(y - centerY, x - centerX);
          const angleDeg = (angle * 180 / Math.PI + 360) % 360;
          
          // 大陆通常在特定角度范围内
          if ((angleDeg > 30 && angleDeg < 150) || 
              (angleDeg > 210 && angleDeg < 330)) {
            return 'middle';
          } else {
            return 'bottom';
          }
        }
        // 中心区域 (距离中心 < 25%) - 城市密集区
        else {
          return 'top';
        }
      }
      
      function showInfoForLayer(layerType) {
        // 隐藏所有文字内容
        infoItems.forEach(item => {
          item.classList.remove('active');
        });
        
        // 显示对应的文字内容
        const targetInfo = document.querySelector(`.info-item[data-layer="${layerType}"]`);
        if (targetInfo) {
          targetInfo.classList.add('active');
        }
        
        // 切换标题显示
        const titleTexts = document.querySelectorAll('.earth-title-text');
        titleTexts.forEach(title => {
          title.classList.remove('active');
        });
        const targetTitle = document.querySelector(`.earth-title-text[data-layer="${layerType}"]`);
        if (targetTitle) {
          targetTitle.classList.add('active');
        }
        
        // 调试信息（可以在控制台查看）
        console.log('当前显示图层:', layerType);
      }
    }


    // Row toggle for list
    function toggleRow(btn) {
      const row = btn.closest('.list-row');
      const next = row.nextElementSibling;
      if (!next || !next.classList.contains('list-row-content')) return;
      const isOpen = row.classList.contains('open');
      if (isOpen) {
        row.classList.remove('open');
      } else {
        row.classList.add('open');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Initialize jsPlumb for UML diagram
      initJsPlumbUML();
    });

    // Global variable to store UML data
    let umlData = null;

    // Load UML data from JSON file
    async function loadUMLData() {
      try {
        const response = await fetch('uml-data.json');
        umlData = await response.json();
        return umlData;
      } catch (error) {
        console.error('Error loading UML data:', error);
        return null;
      }
    }

    // Generate UML card HTML from data
    function generateUMLCard(cardData) {
      const cardHtml = `
        <div class="uml-card ${cardData.type} ${cardData.gridPosition}" data-uml-id="${cardData.id}">
          <div class="uml-card-header">
            ${cardData.number ? `<span class="uml-number">${cardData.number}</span>` : ''}
            <h3 class="uml-title">${cardData.name}</h3>
          </div>
          <div class="uml-attributes">
            ${cardData.attributes.map(attr => `<div class="uml-attribute">${attr}</div>`).join('')}
          </div>
          <div class="uml-separator"></div>
          <div class="uml-methods">
            ${cardData.methods.map(method => `<div class="uml-method">${method}</div>`).join('')}
          </div>
        </div>
      `;
      return cardHtml;
    }


    // Render UML diagram from JSON data
    function renderUMLDiagram(data) {
      const container = document.getElementById('uml-diagram');
      if (!container || !data) return;

      // Clear existing content
      container.innerHTML = '';

      // Generate UML cards
      data.umlClasses.forEach(cardData => {
        container.insertAdjacentHTML('beforeend', generateUMLCard(cardData));
      });

      // Info cards are now only shown in tooltips, not rendered in grid

      // Attach tooltips from info cards to corresponding UML cards
      try {
        // math-challenge-1 to RecommendationEngine
        const info1 = (data.infoCards || []).find(i => i.id === 'math-challenge-1');
        const recEl = document.querySelector('[data-uml-id="recommendation-engine-01"]');
        if (recEl && info1) {
          const titleText = Array.isArray(info1.title) ? info1.title.join(' ') : (info1.title || '');
          const fullText = `${info1.id}\n\n${titleText}\n\n${info1.description || ''}`.trim();
          recEl.setAttribute('data-tooltip', fullText);
        }

        // math-challenge-2 to ARSession
        const info2 = (data.infoCards || []).find(i => i.id === 'math-challenge-2');
        const arEl = document.querySelector('[data-uml-id="ar-session-01"]');
        if (arEl && info2) {
          const titleText = Array.isArray(info2.title) ? info2.title.join(' ') : (info2.title || '');
          const fullText = `${info2.id}\n\n${titleText}\n\n${info2.description || ''}`.trim();
          arEl.setAttribute('data-tooltip', fullText);
        }

        // math-challenge-3 to EmotionAI
        const info3 = (data.infoCards || []).find(i => i.id === 'math-challenge-3');
        const emotionEl = document.querySelector('[data-uml-id="emotion-ai-01"]');
        if (emotionEl && info3) {
          const titleText = Array.isArray(info3.title) ? info3.title.join(' ') : (info3.title || '');
          const fullText = `${info3.id}\n\n${titleText}\n\n${info3.description || ''}`.trim();
          emotionEl.setAttribute('data-tooltip', fullText);
        }
      } catch (e) {
        console.warn('Failed to attach tooltips from info cards', e);
      }
    }

    // Initialize jsPlumb for interactive UML diagram
    async function initJsPlumbUML() {
      // Load UML data first
      const data = await loadUMLData();
      if (!data) {
        console.error('Failed to load UML data');
        return;
      }

      // Render the diagram
      renderUMLDiagram(data);

      // Wait for jsPlumb to be available
      if (typeof jsPlumb === 'undefined') {
        console.warn('jsPlumb not loaded yet, retrying...');
        setTimeout(initJsPlumbUML, 100);
        return;
      }

      // Initialize jsPlumb instance
      const instance = jsPlumb.newInstance({
        container: "uml-diagram",
        paintStyle: data.settings.connectionStyle,
        hoverPaintStyle: { 
          stroke: data.settings.connectionStyle.hoverStroke, 
          strokeWidth: data.settings.connectionStyle.hoverStrokeWidth 
        },
        connector: ["Flowchart", { curviness: 20 }],
        endpoint: "Blank",
        anchor: "Center",
        overlays: [
          ["Arrow", { width: 10, length: 10, location: 1 }]
        ]
      });
      
      // Enable autosize for all UML elements
      instance.setSuspendDrawing(true);
      
      // Store instance globally for control functions
      window.jsPlumbInstance = instance;

      // Make UML elements draggable
      const umlElements = document.querySelectorAll('.uml-card');
      
      umlElements.forEach(element => {
        // Store original position
        if (!element.getAttribute('data-original-left')) {
          element.setAttribute('data-original-left', element.style.left);
          element.setAttribute('data-original-top', element.style.top);
        }
        
        instance.draggable(element, {
          containment: "parent",
          grid: [data.settings.gridSize, data.settings.gridSize],
          drag: function(event) {
            // Update position during drag
            element.style.left = event.pos[0] + 'px';
            element.style.top = event.pos[1] + 'px';
          }
        });
        
        // Enable autosize for this element
        instance.addToGroup("autosize", element);
      });
      
      // Configure autosize group
      instance.setGroupDefaults("autosize", {
        autoSize: true,
        autoSizePadding: 20
      });
      
      // Resume drawing after autosize setup
      instance.setSuspendDrawing(false);
      
      // Trigger autosize for all elements after content is loaded
      setTimeout(() => {
        umlElements.forEach(element => {
          instance.repaint(element);
        });
      }, 100);

      // Add endpoints and create connections
      /*
      data.connections.forEach(conn => {
        const sourceElement = document.querySelector(`[data-uml-id="${conn.source}"]`);
        const targetElement = document.querySelector(`[data-uml-id="${conn.target}"]`);
        
        if (sourceElement && targetElement) {
          instance.addEndpoint(sourceElement, {
            anchor: "Right",
            isSource: true,
            maxConnections: -1
          });
          
          instance.addEndpoint(targetElement, {
            anchor: "Left", 
            isTarget: true,
            maxConnections: -1
          });
          
          instance.connect({
            source: sourceElement,
            target: targetElement,
            label: conn.label,
            paintStyle: data.settings.connectionStyle,
            overlays: [
              ["Arrow", { width: 10, length: 10, location: 1 }],
              ["Label", { label: conn.label, location: 0.5, cssClass: "connection-label" }]
            ]
          });
        }
      });
      */

      // Add click handlers for interactive features
      umlElements.forEach(element => {
        element.addEventListener('click', function() {
          // Highlight connected elements
          const connections = instance.getConnections({ source: this });
          const targetConnections = instance.getConnections({ target: this });
          
          // Reset all elements
          umlElements.forEach(el => el.classList.remove('highlighted'));
          
          // Highlight current element
          this.classList.add('highlighted');
          
          // Highlight connected elements
          [...connections, ...targetConnections].forEach(conn => {
            if (conn.source === this) {
              conn.target.classList.add('highlighted');
            } else {
              conn.source.classList.add('highlighted');
            }
          });
        });
      });

      console.log('jsPlumb UML diagram initialized successfully from JSON data');
    }


  </script>
</body>
</html>

